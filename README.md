# MiniDBMS — документно-ориентированная NoSQL СУБД с сетевым интерфейсом

**Тема:** Разработка сетевого интерфейса для документно-ориентированной СУБД  
**Цель:** Получить практические навыки в разработке сетевых приложений, реализации клиент-серверной архитектуры, сериализации данных для сетевой передачи и организации многопользовательского доступа к системе.

---

## Возможности

### Базовая функциональность (Практика 1)
- **Собственные структуры данных**: HashMap, Vector, B-Tree
- **CRUD-операции**:
  - `insert` — вставка документа  
  - `find` — поиск по условиям  
  - `delete` — удаление по фильтру  
  - `create_index` — создание индексов
- **JSON-хранение** коллекций и индексов  
- **Операторы запросов**: `$and`, `$or`, `$eq`, `$gt`, `$lt`, `$like`, `$in`
- **B-Tree индекс** для числовых полей
- **Персистентность** данных между запусками

### Сетевые возможности (Практика 2)
- **TCP-сервер** с многопоточностью
- **JSON-протокол** для клиент-серверного взаимодействия
- **Многопользовательский доступ** (до 5+ одновременных клиентов)
- **Блокировки с таймаутами** для конкурентного доступа
- **Интерактивный клиент** с REPL-интерфейсом
- **Обработка сетевых ошибок** и автоматическое переподключение

---

## Архитектура проекта

```text
no_sql_dbms/
├── include/                  # Заголовочные файлы
│   ├── utils.hpp
│   ├── vector.hpp            # Собственный Vector
│   ├── algorithms.hpp        # Собственные алгоритмы
│   ├── hash_map.hpp          # Собственная HashMap
│   ├── query_evaluator.hpp
│   ├── btree_index.hpp       # Собственное B-Tree
│   └── collection.hpp
├── src/                      # Реализация модулей
│   ├── utils.cpp
│   ├── query_evaluator.cpp
│   ├── btree_index.cpp
│   ├── collection.cpp
│   ├── main.cpp              # CLI-интерфейс (Практика 1)
│   ├── db_server.cpp         # TCP-сервер (Практика 2)
│   └── db_client.cpp         # Сетевой клиент (Практика 2)
├── parcer/json.hpp           # nlohmann JSON-парсер
├── Makefile
└── databases/                # Хранилище данных
```

---

## Сетевой протокол

- Формат запроса:
```json
{
    "database": "my_database",
    "operation": "insert|find|delete",
    "data": [ ... ],
    "query": { ... }
}
```

- Формат ответа:
```json
{
    "status": "success|error",
    "message": "Описание операции",
    "data": [ ... ],
    "count": 0
}
```

---

## Использование

### Сборка

```bash
make clean
make
```

### Запуск сервера

```bash
./db_server <port> <database_directory>
# Пример:
./db_server 8080 ./databases
```

### Запуск клиента

```bash
# Интерактивный режим
./db_client --host 127.0.0.1 --port 8080 --database my_database

# Режим одной команды
./db_client --host 127.0.0.1 --port 8080 --database my_database --command "INSERT users {\"name\": \"Alice\"}"
```

### Примеры команд в клиенте

```bash
> INSERT users {"name": "Alice", "age": 25, "city": "Moscow"}
> FIND users {"age": {"$gt": 20}}
> DELETE users {"name": "Alice"}
> QUIT
```

---

## Тестирование

Система протестирована с:
- 5+ одновременными клиентами
- Операциями INSERT, FIND, DELETE
- Сложными запросами с операторами сравнения
- Сетевыми таймаутами и переподключениями
- Конкурентным доступом к данным
